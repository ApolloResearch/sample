#!/usr/bin/env bash

# If any command fails, exit immediately with that command's exit status
set -eo pipefail

# Find all changed python files for this commit
CHANGED_PYTHON_FILES=$(git diff --name-only --cached --diff-filter=ACMR | grep '\.py$' || true)

if [[ -n "$CHANGED_PYTHON_FILES" ]]
then
    pyright $CHANGED_PYTHON_FILES
	# Fix all autofixable problems (which sorts imports)
	ruff check --fix-only $CHANGED_PYTHON_FILES
	ruff format $CHANGED_PYTHON_FILES
    pytest
fi
